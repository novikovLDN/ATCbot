# Инструкция по деплою на Railway

Это руководство поможет вам безопасно задеплоить Telegram-бота на Railway.

## Подготовка репозитория

✅ **Проверьте, что в репозитории НЕТ:**
- `.env` файлов
- Файлов баз данных (`*.db`, `*.sqlite`)
- Хардкода токенов в коде
- Секретов в истории коммитов

✅ **Убедитесь, что есть:**
- `.gitignore` (должен исключать `.env`, `*.db`, `*.sqlite`)
- `requirements.txt` с зависимостями
- `config.py` использует `os.getenv()` для получения секретов
- `main.py` - точка входа

## Шаг 1: Регистрация на Railway

1. Перейдите на https://railway.app
2. Нажмите **"Login"** и войдите через GitHub
3. Подтвердите доступ Railway к вашему GitHub аккаунту

## Шаг 2: Создание проекта

1. На главной странице Railway нажмите **"New Project"**
2. Выберите **"Deploy from GitHub repo"**
3. Если репозиторий не подключен:
   - Нажмите **"Configure GitHub App"**
   - Выберите репозиторий `novikovLDN/ATCbot`
   - Нажмите **"Install"**
4. Выберите репозиторий `ATCbot` из списка
5. Railway автоматически начнет деплой

## Шаг 3: Настройка переменных окружения (КРИТИЧЕСКИ ВАЖНО)

⚠️ **БЕЗ ЭТИХ ПЕРЕМЕННЫХ БОТ НЕ ЗАПУСТИТСЯ!**

1. В проекте Railway откройте вкладку **"Variables"**
2. Нажмите **"+ New Variable"**
3. Добавьте следующие переменные:

### BOT_TOKEN
- **Key:** `BOT_TOKEN`
- **Value:** ваш токен от @BotFather (например: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)
- ⚠️ Без кавычек!

### ADMIN_TELEGRAM_ID
- **Key:** `ADMIN_TELEGRAM_ID`
- **Value:** ваш Telegram ID (число, например: `123456789`)
- ⚠️ Без кавычек!
- Чтобы узнать свой ID: напишите @userinfobot в Telegram

4. Нажмите **"Add"** для каждой переменной
5. Railway автоматически перезапустит сервис после добавления переменных

## Шаг 4: Настройка команды запуска

1. Откройте вкладку **"Settings"**
2. Найдите раздел **"Start Command"**
3. Установите команду запуска:

```bash
python main.py
```

Если Railway автоматически определил команду - оставьте как есть.

## Шаг 5: Проверка логов

1. Откройте вкладку **"Logs"**
2. Проверьте вывод. Ожидается:

```
✅ База данных инициализирована
✅ Бот запущен
```

### Типовые ошибки:

**❌ ERROR: BOT_TOKEN environment variable is not set!**
- Решение: добавьте переменную `BOT_TOKEN` в разделе Variables

**❌ ERROR: ADMIN_TELEGRAM_ID environment variable is not set!**
- Решение: добавьте переменную `ADMIN_TELEGRAM_ID` в разделе Variables

**❌ Unauthorized / Invalid token**
- Решение: проверьте правильность токена в переменной `BOT_TOKEN`

**❌ ModuleNotFoundError**
- Решение: проверьте, что `requirements.txt` содержит все зависимости

## Шаг 6: Тестирование бота

После успешного запуска:

1. Найдите вашего бота в Telegram (по username от @BotFather)
2. Отправьте команду `/start`
3. Проверьте:
   - ✅ Выбор языка работает
   - ✅ Главное меню отображается
   - ✅ Команда `/profile` работает
   - ✅ Покупка VPN → выбор тарифа → СБП работает
   - ✅ После "Я оплатил" админ получает уведомление

## Шаг 7: Обновление VPN-ключей

Если нужно добавить новые VPN-ключи:

1. Обновите файл `vpn_keys.txt` локально
2. Сделайте commit и push:
   ```bash
   git add vpn_keys.txt
   git commit -m "Update VPN keys"
   git push
   ```
3. Railway автоматически перезапустит сервис

## Полезная информация

### Мониторинг

- **Logs** - просмотр логов в реальном времени
- **Metrics** - использование ресурсов
- **Settings** - настройки проекта

### Перезапуск сервиса

В разделе **"Deployments"** можно:
- Посмотреть историю деплоев
- Откатиться на предыдущую версию
- Перезапустить сервис вручную

### Бесплатный тариф Railway

- ✅ 500 часов работы в месяц (достаточно для MVP)
- ✅ Автоматическое развертывание из GitHub
- ✅ Переменные окружения
- ✅ HTTPS по умолчанию

⚠️ **Важно:** При превышении лимита сервис приостанавливается. Для стабильной работы 24/7 рекомендуется платный тариф.

## Безопасность

✅ **Что сделано правильно:**
- Токены хранятся только в переменных окружения Railway
- `.gitignore` исключает `.env` и базы данных
- `config.py` валидирует переменные окружения
- Нет секретов в коде

⚠️ **Важно помнить:**
- Никогда не коммитьте `.env` файлы
- Не публикуйте токены в Issues/Pull Requests
- Регулярно проверяйте логи на наличие ошибок

## Поддержка

Если возникли проблемы:

1. Проверьте логи в Railway
2. Убедитесь, что все переменные окружения установлены
3. Проверьте, что бот запущен в Telegram (не заблокирован @BotFather)
4. Убедитесь, что репозиторий синхронизирован с GitHub

## Ссылки

- Репозиторий: https://github.com/novikovLDN/ATCbot.git
- Railway Dashboard: https://railway.app/dashboard
- Telegram Bot API: https://core.telegram.org/bots/api

